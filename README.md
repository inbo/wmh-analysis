# Analysis of migration patterns of western marsh harriers using GPS tracking data

## Rationale

This repository contains R code for the paper:

> Vansteelant WMG, Klaassen R, Strandberg R, Janssens K, T´Jollyn F, Bouten W, Koks BJ & Anselin A (In press) Western Marsh Harriers _Circus aeruginosus_ from nearby breeding areas migrate along comparable loops but on contrasting schedules in the West African-Eurasian flyway. Journal of Ornithology.

To study their migration patterns, the paper makes use of GPS tracking data of 3 breeding populations of _Circus aeruginosus_:

1. Near the Belgium-Netherlands border in the provinces East Flanders (Belgium) and Zeeland (the Netherlands): 4 tracked birds, 
data collected by [INBO](www.inbo.be/en), data available at [Anselin et al. (2019)](http://doi.org/10.5281/zenodo.3532941).
2. The province of Groningen (the Netherlands): 2 tracked birds, data collected by the 
[Dutch Montagu’s Harrier Foundation](http://werkgroepgrauwekiekendief.nl/), data available at [Koks et al. (2019)](http://doi.org/10.5281/zenodo.3552508).
3. Southern Sweden: 4 tracked birds, data collected by [Lund University](https://www.lunduniversity.lu.se/).

## Repo structure

The repository structure is based on [Cookiecutter Data Science](http://drivendata.github.io/cookiecutter-data-science/). Files and directories indicated with `GENERATED` should not be edited manually.

```
├── README.md              : Description of this repository
├── LICENSE                : Repository license
├── wmh-analysis.Rproj     : RStudio project file
├── .gitignore             : Files and directories to be ignored by git
│
├── data                   
│   ├── raw                : Data used for this analysis
│   └── maps               : Maps downloaded by scripts (ignored by git) GENERATED
│
├── reports
│   ├── figures            : Figures generated by scripts (ignored by git) GENERATED
│   └── tables             : Tables generated by scripts (ignored by git) GENERATED
│
└── src                    : Analysis scripts
    └── resampling         : Data resampling scripts
```

## Usage

### Packages

Run [`src/p1_loadPackages.R`](src/p1_loadPackages.R) to install and load all required packages.

### Analysis scripts

These scripts are available in [`src`](src) and can be used to reproduce all figures and analyses from the paper. They are intended to be run consecutively.

1. `p2a_analyses_read_processed_data.R`: read data files
2. `p2b_analyses_annotate&clean_processed_data.R`: clean data
3. `p3_Fig1A_Lat-vs-yday.R`: make figure 1A of the paper
4. `p3a_Fig1B&C.R`: make figures 1B and 1C
5. `p3b_FigS2_Wintering-fin.R`: make figure S2
6. `p4_wind-fin.R`: read wind data and calculate mean daily wind components
7. `p5_CompileData-PerTrip-PerID_TableS1&S9.R`: make table S1 and S9
8. `p6_Figure2&TablesS5-S6.R`: make table S5 and S6
9. `p6_TableS2.R`: make table S2
10. `p6a_TableS3_Long-diff-pops.R`: make table S3
11. `p6b_TablesS7&8_WindSelectivity_glmms&posthoc.R`: make table S7 and S8

### Side scripts

These scripts are helper scripts automatically loaded when running the main analysis scripts.

- `pt2pt_fxns.R`: functions to compute distance, duration and speed
- `sidescript_CalcDailyStats.R`: compute daily statistics
- `sidescript_CalcStopovers.R`: compute coordinates and duration of stopovers
- `sidescript_readDEM.R`: read and manipulate DEM for making maps
- `sidescript_readSwedes.R`: read Swedish dataset, make selection and manipulate data to match with `MH-resampled-23092017.csv`

### Resampling scripts

These scripts are available in [`src/resampling`](src/resampling) and were used to resample the raw GPS data for the Belgium-Netherlands and Groningen datasets stored in the [UvA-BiTS database](https://www.uva-bits.nl) to an hourly resolution. The resampled data are stored in `data`, so running this code is not required to replicate our analysis.

## Data

### Project data (accessible in this repo)

- `annotation.csv`: annotated version of the Belgian and Dutch dataset. Wouter Vansteelant determined the start and end dates of migratory and non-migratory periods through expert interpretation of tracks in Google Earth.
    - Bird name [`name`]
	- Migratory cycle [`cycle`] (winter, spring, summer, autumn + year)
	- Starting date [`date`]
    - Behaviour type [`type`] (breeding, dead, migration, move, pre-migration, winter.stage1, winter.stage2, winter.stage3)
    - Criteria for selection in analysis ([`complete`], [`use.date`])
- `annotation-swedes.csv`: annotated version of the Swedish dataset. Wouter Vansteelant determined the start and end dates of migratory and non-migratory periods through expert interpretation of tracks in Google Earth.
    - Bird name [`name`]
	- Migratory cycle [`cycle`] (winter, spring, summer, autumn + year)
	- Starting date [`date`]
    - Behaviour type [`type`] (breeding, dead, migration, move, pre-migration, winter.stage1, winter.stage2)
    - Criteria for selection in analysis ([`complete`], [`use.date`])
- `MH-resampled-23092017.csv`: Belgian and Dutch tracking data downloaded from the UvA-BiTS database on September 23rd, 2017
	- Device and individual code ([`dev`], [`name`]
	- Coordinates ([`lat`], [`lon`], [`alt`])
	- Date and time
		- Date time [`dt`]
		- Year [`yr`]
		- [`season`] (spring/autumn)
		- Julian time [`julian`]
		- day of year [`yday`]
	- Data provider [`origin`]
	- Derived codes ([`indday`] (name_julian), [`migr`] (name_yr_season))
	- Calculated parameters using functions in script [`pt2pt_fxns`]
		- Distance [`dist`]
		- Duration [`dur`]
		- Speed ([`spd`] = [`dist`]/[`dur`])		 
- `swedes.csv`: Swedish tracking data
- `weather.csv`: daily tailwind conditions calculated using the method of [Klaassen et al. (2010)](https://doi.org/10.1111/j.1600-048X.2010.05058.x). u- and v-wind components were obtained from the NOAA NCEP global atmospheric reanalysis model.

### External GIS data (available through web links)

- `ne_50m_admin_0_countries`: shapefile containing country boundaries, source: Natural Earth ( https://www.naturalearthdata.com/downloads/50m-cultural-vectors/50m-admin-0-countries-2/)
- `alt_30s_bil`: raster file containing a DEM of the world, source: worldclim, version 1.4 (http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/grid/cur/alt_30s_bil.zip)

## Acknowledgements

This work makes use of data and/or infrastructure provided by INBO and funded by Research Foundation - Flanders (FWO) as part of the Belgian contribution to [LifeWatch](https://lifewatch.be).
